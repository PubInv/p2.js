<!DOCTYPE html>
<html>
<head>
    <title>Piston demo - p2.js physics engine</title>
    <script src="../build/p2.js"></script>
    <script src="../build/p2.renderer.js"></script>
    <link href="css/demo.css" rel="stylesheet"/>
    <meta name="description" content="Shows how to build a small piston mechanism.">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>
<body>
    <script>

var R = 0.7,
L = R * 3 / 2;

// Create demo application
var app = new p2.WebGLRenderer(function(){

    var world = new p2.World({
        gravity : [0,-1]
    });

    this.setWorld(world);

    world.solver.iterations = 30;
    world.solver.tolerance = 0.01;

    // Create static dummy body that we can constrain other bodies to
    var dummyBody = new p2.Body({
        mass: 0,
    });
    world.addBody(dummyBody);

    {
    // Create arm
    var armShape =  new p2.Box({ width: L, height: 0.1*L });
    var armBody = new p2.Body({
        mass:1,
	position: [L*(5/2),0]
    });
    armBody.addShape(armShape);
    world.addBody(armBody);


    // Constrain it to the world
    var c = new p2.RevoluteConstraint(armBody, dummyBody, {
        worldPivot: [L*2, 0],
        collideConnected: false
    });

    world.addConstraint(c);

    // SecondArm
    var secondArmShape = new p2.Box({ width: L, height: 0.1*L });
    var secondArmBody = new p2.Body({
        mass: 1,
	position: [L*3,-L/2],
	angle: Math.PI/2
    });
    secondArmBody.addShape(secondArmShape);
    world.addBody(secondArmBody);

    // Connect secondArm to arm
    var c3 = new p2.RevoluteConstraint(secondArmBody, armBody, {
        localPivotA: [L/2,0],
        localPivotB: [L/2,0],
        collideConnected: false
    });
   world.addConstraint(c3);
}
    {
        // Create arm
        var arm2Shape =  new p2.Box({ width: L*2, height: 0.1*L });
        var arm2Body = new p2.Body({
            mass:1,
	    position: [-(L*3),0]
        });
        arm2Body.addShape(arm2Shape);
        world.addBody(arm2Body);


        // Constrain it to the world
        var c = new p2.RevoluteConstraint(arm2Body, dummyBody, {
            worldPivot: [-L*2, 0],
            collideConnected: false
        });
	world.addConstraint(c);
    }

    var line = new p2.Line(L*4);
    var lbody = new p2.Body({
        position : [0,0],
    });
    lbody.addShape(line);
    world.addBody(lbody);
    
    
    // Create ground
    var planeShape = new p2.Plane();
    var plane = new p2.Body({
        position : [0,-5],
    });
    plane.addShape(planeShape);
    world.addBody(plane);


                // Create boxes
            box = new p2.Body({
                position:[3,2],
                mass : 1,
                angularVelocity : -0.2
            });
            box.addShape(new p2.Box({ width: 1/2, height: 1/2 }), [L/2,0], 0);
            box.addShape(new p2.Box({ width: 1/2, height: 1/2 }), [-L/2,0], 0);
            world.addBody(box);

});

    </script>
</body>
</html>
